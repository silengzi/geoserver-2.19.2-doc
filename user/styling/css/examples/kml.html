<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>KML &mdash; GeoServer 2.19.2 User Manual</title>
  <link rel="stylesheet" href="../../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.19.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../../searchindex.js"></script>
  <link rel="shortcut icon" href="../../../_static/geoserver.ico"/>
      <link rel="search" title="Search" href="../../../search.html" />
      <link rel="top" title="GeoServer 2.19.2 User Manual" href="../../../index.html" />
      <link rel="up" title="Styling examples" href="index.html" />
      <link rel="next" title="Miscellaneous" href="misc.html" />
      <link rel="prev" title="Using transformation functions" href="transformation.html" />
</head>
<body class="styling/css/examples/kml">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../../index.html">GeoServer 2.19.2 User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/about">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/download">Download</a></li>
        <!--<li><a href="../../../index.html">Documentation</a></li>-->
      </ul>
        <form id="quick-search" action="../../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content-left" class="content-border"></div>
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../../index.html">GeoServer 2.19.2 User Manual</a> &raquo;</li>
  <li><a href="../../index.html" accesskey="U">Styling</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">CSS Styling</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Styling examples</a> &raquo;</li>
  <li>KML</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../../../py-modindex.html" title="Python Module Index"
       accesskey="">modules</a></li>
  <li>
    <a href="misc.html" title="Miscellaneous"
       accesskey="N">next</a>|</li>
  <li>
    <a href="transformation.html" title="Using transformation functions"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="kml">
<span id="css-example-kml"></span><h1>KML<a class="headerlink" href="#kml" title="Permalink to this headline">¶</a></h1>
<div class="section" id="detecting-raster-to-vector-switch-in-kml">
<h2>Detecting raster to vector switch in KML<a class="headerlink" href="#detecting-raster-to-vector-switch-in-kml" title="Permalink to this headline">¶</a></h2>
<p>GeoServer 2.4 added a new icon server that KML output uses to make sure the point symbolisers look the same as in
a normal WMS call no matter what scale they are looked at.</p>
<p>This may pose some issue when working in the default KML generation mode, where the map is a ground overlay up to
a certain scale, and switches to a vector, clickable representation once the number of features in the visualization
fall below a certain scale (as controlled by the <code class="docutils literal notranslate"><span class="pre">KMSCORE</span></code> parameter): the end user is not informed “visually” that
the switch happened.</p>
<p>There is however a custom enviroment variable, set by the KML generator, that styles can leverage to know whether
the KML generation is happening in ground overlay or vector mode.</p>
<p>The following example leverages this function to show a larger point symbol when points become clickable:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="p">{</span>
  <span class="n">mark</span><span class="p">:</span> <span class="nf">symbol</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">:</span><span class="nd">mark</span> <span class="o">[</span><span class="nt">env</span><span class="o">(</span><span class="s1">&#39;kmlOutputMode&#39;</span><span class="o">)</span> <span class="o">=</span> <span class="s1">&#39;vector&#39;</span><span class="o">]</span> <span class="p">{</span>
  <span class="k">size</span><span class="p">:</span> <span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">:</span><span class="nd">mark</span> <span class="p">{</span>
  <span class="k">size</span><span class="p">:</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">fill</span><span class="p">:</span> <span class="kc">yellow</span><span class="p">;</span>
  <span class="n">stroke</span><span class="p">:</span> <span class="kc">black</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will result in the following output:</p>
<div class="figure align-center" id="id1">
<img alt="../../../_images/kml-raster.png" src="../../../_images/kml-raster.png" />
<p class="caption"><span class="caption-text"><em>Raster output, points are not yet clickable</em></span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-center" id="id2">
<img alt="../../../_images/kml-vector.png" src="../../../_images/kml-vector.png" />
<p class="caption"><span class="caption-text"><em>Vector output, points are clickable and painted as larger icons</em></span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>One important bit about the above CSS is that the order of the rules is important. The CSS to SLD translator uses specificity to decide which rule overrides which other one, and the specificity is driven, at the time of writing, only by scale rules and access to attributes. The filter using the <code class="docutils literal notranslate"><span class="pre">kmlOutputMode</span></code> filter is not actually using any feature attribute, so it has the same specificity as the catch all <code class="docutils literal notranslate"><span class="pre">:mark</span></code> rule. Putting it first ensures that it overrides the catch all rule anyways, while putting it second would result in the output size being always 4.</p>
</div>
<div class="section" id="getting-kml-marks-similar-to-the-old-kml-encoder">
<h2>Getting KML marks similar to the old KML encoder<a class="headerlink" href="#getting-kml-marks-similar-to-the-old-kml-encoder" title="Permalink to this headline">¶</a></h2>
<p>The old KML generator (prior to GeoServer 2.4) was not able to truly respect the marks own shape, and as a result, was simply applying the
mark color to a fixed bull’s eye like icon, for example:</p>
<div class="figure align-center">
<img alt="../../../_images/legacy-kml-marks.png" src="../../../_images/legacy-kml-marks.png" />
</div>
<p>Starting with GeoServer 2.4 the KML engine has been rewritten, and among other things, it can produce an exact
representation of the marks, respecting not only color, but also shape and stroking.
However, what if one want to reproduce the old output look?</p>
<p>The solution is to leverage the ability to respect marks appearance to the letter, and combine two superimposed
marks to generate the desired output:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="p">{</span>
  <span class="n">mark</span><span class="p">:</span> <span class="nf">symbol</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">),</span> <span class="nf">symbol</span><span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">);</span>
  <span class="n">mark-size</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">:</span><span class="nd">nth-mark</span><span class="o">(</span><span class="nt">1</span><span class="o">)</span> <span class="p">{</span>
  <span class="n">fill</span><span class="p">:</span> <span class="kc">red</span><span class="p">;</span>
  <span class="n">stroke</span><span class="p">:</span> <span class="kc">black</span><span class="p">;</span>
  <span class="n">stroke-width</span><span class="p">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">:</span><span class="nd">nth-mark</span><span class="o">(</span><span class="nt">2</span><span class="o">)</span> <span class="p">{</span>
  <span class="n">fill</span><span class="p">:</span> <span class="kc">black</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Which results in the following Google Earth output:</p>
<div class="figure align-center">
<img alt="../../../_images/kml-eyesbull-mark.png" src="../../../_images/kml-eyesbull-mark.png" />
</div>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="transformation.html" title="previous chapter">Using transformation functions</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="misc.html" title="next chapter">Miscellaneous</a></div>
      </div>
      </div><!-- /#content> -->
      <div id="content-right" class="content-border"></div>
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">KML</a><ul>
<li><a class="reference internal" href="#detecting-raster-to-vector-switch-in-kml">Detecting raster to vector switch in KML</a></li>
<li><a class="reference internal" href="#getting-kml-marks-similar-to-the-old-kml-encoder">Getting KML marks similar to the old KML encoder</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="transformation.html" title="previous chapter">Using transformation functions</a></li>
            <li>Next: <a href="misc.html" title="next chapter">Miscellaneous</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
                
        <li><a href="https://github.com/geoserver/geoserver/tree/master/doc/en/user/source/styling/css/examples/kml.rst">Edit</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright 2021, Open Source Geospatial Foundation. License <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution</a>.
    Last updated on Jul 20, 2021.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>