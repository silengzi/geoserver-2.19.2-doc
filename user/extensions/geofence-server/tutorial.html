<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Using the Internal GeoFence server (Tutorial) &mdash; GeoServer 2.19.2 User Manual</title>
  <link rel="stylesheet" href="../../static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.19.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../static/jquery.js"></script>
  <script type="text/javascript" src="../../static/doctools.js"></script>
  <script type="text/javascript" src="../../static/searchtools.js"></script>
  <script type="text/javascript" src="../../searchindex.js"></script>
  <link rel="shortcut icon" href="../../static/geoserver.ico"/>
      <link rel="search" title="Search" href="../../search.html" />
      <link rel="top" title="GeoServer 2.19.2 User Manual" href="../../index.html" />
      <link rel="up" title="Geofence Internal Server" href="index.html" />
      <link rel="next" title="Migrating old GeoFence configuration to GeoServer 2.12 and following" href="migration.html" />
      <link rel="prev" title="AdminRules Rest API" href="rest-adminrule.html" />
</head>
<body class="extensions/geofence-server/tutorial">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../index.html">GeoServer 2.19.2 User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/about">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/download">Download</a></li>
        <!--<li><a href="../../index.html">Documentation</a></li>-->
      </ul>
        <form id="quick-search" action="../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content-left" class="content-border"></div>
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../index.html">GeoServer 2.19.2 User Manual</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Extensions</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Geofence Internal Server</a> &raquo;</li>
  <li>Using the Internal GeoFence server (Tutorial)</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../../py-modindex.html" title="Python Module Index"
       accesskey="">modules</a></li>
  <li>
    <a href="migration.html" title="Migrating old GeoFence configuration to GeoServer 2.12 and following"
       accesskey="N">next</a>|</li>
  <li>
    <a href="rest-adminrule.html" title="AdminRules Rest API"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="using-the-internal-geofence-server-tutorial">
<h1>Using the Internal GeoFence server (Tutorial)<a class="headerlink" href="#using-the-internal-geofence-server-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This tutorial shows how to install and configure the <a class="reference internal" href="index.html#community-geofence-server"><span class="std std-ref">Geofence Internal Server</span></a> plug-in. It shows how to create rules in two ways: using the GUI and REST methods.</p>
<p>The tutorial assumes:</p>
<ul>
<li><p>GeoServer is running on <a class="reference external" href="http://localhost:8080/geoserver">http://localhost:8080/geoserver</a></p></li>
<li><p>You have a user/group service called “default” that allows the creation of new users. If your primary user/group service is not called “default”, you must start geoserver with the following java system property present:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">org</span><span class="o">.</span><span class="n">geoserver</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">DefaultUserGroupServiceName</span><span class="o">=&lt;</span><span class="n">name_of_usergroupservice</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
<p>with &lt;name_of_usergroupservice&gt; a user/group service that allows the creation of new users.</p>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Install the plugin-in, see <a class="reference internal" href="installing.html#geofence-server-install"><span class="std std-ref">GeoFence promoted to extension since version 2.15</span></a>. Configure the user/group service as described above if necessary.</p>
<p>Restart GeoServer.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since we defined no rules yet, the default behavior of GeoFence is to deny access to all resources.</p>
</div>
</div></blockquote>
<p>There should now be a <span class="guilabel">GeoFence Server</span> link on the left side of the screen after logging in. Click on it.
This is the configuration page of your internal GeoFence.</p>
<div class="figure align-center">
<img alt="../../_images/tutorial_rulespage1.png" src="../../_images/tutorial_rulespage1.png" />
</div>
</div>
<div class="section" id="creating-new-rules-with-the-gui">
<h2>Creating new Rules with the GUI<a class="headerlink" href="#creating-new-rules-with-the-gui" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Click on the “Add new rule” link. Change only “Access” to “DENY”.</p></li>
</ol>
<div class="figure align-center">
<img alt="../../_images/tutorial_rulepage1.png" src="../../_images/tutorial_rulepage1.png" />
</div>
<p>Click on “Save”.</p>
<div class="figure align-center">
<img alt="../../_images/tutorial_rulespage2.png" src="../../_images/tutorial_rulespage2.png" />
</div>
<p>We have now expressed that the first rule (with lowest priority) disallows everyone from everything. The following more specific rules we make will provide the exceptions to that general rule. It is also possible to do it the other way (allow everyone to anything as most general rule and specify exceptions to that.)</p>
<ol class="arabic simple" start="2">
<li><p>As a next step, we will grant the administrator access to everything. Click on “Add new rule” again. Change “Role” to “ADMIN” and click “Save”.</p></li>
</ol>
<div class="figure align-center">
<img alt="../../_images/tutorial_rulepage2.png" src="../../_images/tutorial_rulepage2.png" />
</div>
<div class="figure align-center">
<img alt="../../_images/tutorial_rulespage3.png" src="../../_images/tutorial_rulespage3.png" />
</div>
<p>You now have a working, basic security configuration.</p>
</div>
<div class="section" id="creating-rules-with-the-rest-api">
<h2>Creating rules with the REST API<a class="headerlink" href="#creating-rules-with-the-rest-api" title="Permalink to this headline">¶</a></h2>
<p>1. Open a new tab with your browser and go to the following URL: <a class="reference external" href="http://localhost:8080/geoserver/geofence/rest/rules">http://localhost:8080/geoserver/geofence/rest/rules</a>.
You should get an XML representation of your rules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;Rules count=&quot;2&quot;&gt;
      &lt;Rule id=&quot;2&quot;&gt;
              &lt;access&gt;ALLOW&lt;/access&gt;
              &lt;priority&gt;0&lt;/priority&gt;
              &lt;roleName&gt;ADMIN&lt;/roleName&gt;
      &lt;/Rule&gt;
      &lt;Rule id=&quot;1&quot;&gt;
              &lt;access&gt;DENY&lt;/access&gt;
              &lt;priority&gt;1&lt;/priority&gt;
      &lt;/Rule&gt;
&lt;/Rules&gt;
</pre></div>
</div>
<p>2. Let us first create a new user.
Do this by sending a POST request to the following URL <a class="reference external" href="http://localhost:8080/geoserver/rest/security/usergroup/users">http://localhost:8080/geoserver/rest/security/usergroup/users</a> with the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;user&gt;
      &lt;userName&gt;michaeljfox&lt;/userName&gt;
      &lt;password&gt;back2$future&lt;/password&gt;
      &lt;enabled&gt;true&lt;/enabled&gt;
&lt;/user&gt;
</pre></div>
</div>
<p>You should receive a <code class="docutils literal notranslate"><span class="pre">201</span> <span class="pre">Created</span></code> HTTP Response.</p>
<p>3. Now we will create an access rule for this user.
Do this by sending a POST request to the following URL: <a class="reference external" href="http://localhost:8080/geoserver/geofence/rest/rules">http://localhost:8080/geoserver/geofence/rest/rules</a> with the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">userName</span><span class="o">&gt;</span><span class="n">michaeljfox</span><span class="o">&lt;/</span><span class="n">userName</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">workspace</span><span class="o">&gt;</span><span class="n">topp</span><span class="o">&lt;/</span><span class="n">workspace</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">layer</span><span class="o">&gt;</span><span class="n">states</span><span class="o">&lt;/</span><span class="n">layer</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">service</span><span class="o">&gt;</span><span class="n">WMS</span><span class="o">&lt;/</span><span class="n">service</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">request</span><span class="o">&gt;</span><span class="n">GetMap</span><span class="o">&lt;/</span><span class="n">request</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">access</span><span class="o">&gt;</span><span class="n">ALLOW</span><span class="o">&lt;/</span><span class="n">access</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">Rule</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Again, you should receive a <code class="docutils literal notranslate"><span class="pre">201</span> <span class="pre">Created</span></code> HTTP Response.
When browsing to the URL <a class="reference external" href="http://localhost:8080/geoserver/geofence/rest/rules">http://localhost:8080/geoserver/geofence/rest/rules</a> we should now see the following information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;Rules count=&quot;2&quot;&gt;
      &lt;Rule id=&quot;3&quot;&gt;
              &lt;access&gt;ALLOW&lt;/access&gt;
              &lt;layer&gt;states&lt;/layer
              &lt;priority&gt;0&lt;/priority&gt;
              &lt;request&gt;GETMAP&lt;/request&gt;
              &lt;service&gt;WMS&lt;/service&gt;
              &lt;userName&gt;michaeljfox&lt;/userName&gt;
              &lt;workspace&gt;topp&lt;/workspace&gt;
      &lt;/Rule&gt;
      &lt;Rule id=&quot;2&quot;&gt;
              &lt;access&gt;ALLOW&lt;/access&gt;
              &lt;priority&gt;0&lt;/priority&gt;
              &lt;roleName&gt;ADMIN&lt;/roleName&gt;
      &lt;/Rule&gt;
      &lt;Rule id=&quot;1&quot;&gt;
              &lt;access&gt;DENY&lt;/access&gt;
              &lt;priority&gt;1&lt;/priority&gt;
      &lt;/Rule&gt;
&lt;/Rules&gt;
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>It should now be possible to log on with username <code class="docutils literal notranslate"><span class="pre">michaeljfox</span></code> and password <code class="docutils literal notranslate"><span class="pre">back2$future</span></code> and perform a <code class="docutils literal notranslate"><span class="pre">GetMap</span></code> on the layer <code class="docutils literal notranslate"><span class="pre">topp:states</span></code>, but nothing else.</p></li>
</ol>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="rest-adminrule.html" title="previous chapter">AdminRules Rest API</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="migration.html" title="next chapter">Migrating old GeoFence configuration to GeoServer 2.12 and following</a></div>
      </div>
      </div><!-- /#content> -->
      <div id="content-right" class="content-border"></div>
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Using the Internal GeoFence server (Tutorial)</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li><a class="reference internal" href="#creating-new-rules-with-the-gui">Creating new Rules with the GUI</a></li>
<li><a class="reference internal" href="#creating-rules-with-the-rest-api">Creating rules with the REST API</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="rest-adminrule.html" title="previous chapter">AdminRules Rest API</a></li>
            <li>Next: <a href="migration.html" title="next chapter">Migrating old GeoFence configuration to GeoServer 2.12 and following</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
                
        <li><a href="https://github.com/geoserver/geoserver/tree/master/doc/en/user/source/extensions/geofence-server/tutorial.rst">Edit</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright 2021, Open Source Geospatial Foundation. License <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution</a>.
    Last updated on Jul 20, 2021.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>