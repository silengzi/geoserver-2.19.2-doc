<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Key authentication module &mdash; GeoServer 2.19.2 User Manual</title>
  <link rel="stylesheet" href="../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.19.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../searchindex.js"></script>
  <link rel="shortcut icon" href="../../_static/geoserver.ico"/>
      <link rel="search" title="Search" href="../../search.html" />
      <link rel="top" title="GeoServer 2.19.2 User Manual" href="../../index.html" />
      <link rel="up" title="Extensions" href="../index.html" />
      <link rel="next" title="Control flow module" href="../controlflow/index.html" />
      <link rel="prev" title="Extensions" href="../index.html" />
</head>
<body class="extensions/authkey/index">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../index.html">GeoServer 2.19.2 User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/about">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/download">Download</a></li>
        <!--<li><a href="../../index.html">Documentation</a></li>-->
      </ul>
        <form id="quick-search" action="../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content-left" class="content-border"></div>
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../index.html">GeoServer 2.19.2 User Manual</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Extensions</a> &raquo;</li>
  <li>Key authentication module</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../../py-modindex.html" title="Python Module Index"
       accesskey="">modules</a></li>
  <li>
    <a href="../controlflow/index.html" title="Control flow module"
       accesskey="N">next</a>|</li>
  <li>
    <a href="../index.html" title="Extensions"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="key-authentication-module">
<span id="authkey"></span><h1>Key authentication module<a class="headerlink" href="#key-authentication-module" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">authkey</span></code> module for GeoServer allows for a very simple authentication protocol designed for
OGC clients that cannot handle any kind of security protocol, not even the HTTP basic authentication.</p>
<p>For these clients the module allows a minimal form of authentication by appending a unique key in the
URL that is used as the sole authentication token. Obviously this approach is open to security token
sniffing and must always be associated with the use of HTTPS connections.</p>
<p>A sample authenticated request looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://localhost:8080/geoserver/topp/wms?service=WMS&amp;version=1.3.0&amp;request=GetCapabilities&amp;authkey=ef18d7e7-963b-470f-9230-c7f9de166888
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">authkey=ef18d7e7-963b-470f-9230-c7f9de166888</span></code> is associated to a specific user (more on this later).
The capabilities document contains backlinks to the server itself, linking to the URLs that can be used
to perform GetMap, GetFeatureInfo and so on.
When the <code class="docutils literal notranslate"><span class="pre">authkey</span></code> parameter is provided the backlinks will contain the authentication key as well,
allowing any compliant WMS client to access secured resources.</p>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">authkey</span></code> module is meant to be used with OGC services. It won’t work properly against the
administration GUI, nor RESTConfig.</p>
</div>
<div class="section" id="key-providers">
<h2>Key providers<a class="headerlink" href="#key-providers" title="Permalink to this headline">¶</a></h2>
<p>Key providers are responsible for mapping the authentication keys to a user. The authentication key
itself is a UUID (Universal unique Identifier). A key provider needs a user/group service and it is
responsible for synchronizing the authentication keys with the users contained in this service.</p>
<div class="section" id="key-provider-using-user-properties">
<h3>Key provider using user properties<a class="headerlink" href="#key-provider-using-user-properties" title="Permalink to this headline">¶</a></h3>
<p>This key provider uses a user property <code class="docutils literal notranslate"><span class="pre">UUID</span></code> to map the authentication key to the user. User
properties are stored in the user/group service. Synchronizing is simple since the logic has
to search for users not having the property <code class="docutils literal notranslate"><span class="pre">UUID</span></code> and add it. The property value is a generated
UUID.</p>
<blockquote>
<div><p>UUID=b52d2068-0a9b-45d7-aacc-144d16322018</p>
</div></blockquote>
<p>If the user/group service is read only, the property has to be added from outside, no synchronizing
is possible.</p>
</div>
<div class="section" id="key-provider-using-a-property-file">
<h3>Key provider using a property file<a class="headerlink" href="#key-provider-using-a-property-file" title="Permalink to this headline">¶</a></h3>
<p>This key provider uses a property file named <code class="docutils literal notranslate"><span class="pre">authkeys.properties</span></code>. The default user/group service
is named <code class="docutils literal notranslate"><span class="pre">default</span></code>. The <code class="docutils literal notranslate"><span class="pre">authkeys.properties</span></code> for this service would be located at</p>
<p><code class="docutils literal notranslate"><span class="pre">$GEOSERVER_DATA_DIR/security/usergroup/default/authkeys.propeties</span></code></p>
<p>A sample file looks as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Format is authkey=username</span>
<span class="n">b52d2068</span><span class="o">-</span><span class="mi">0</span><span class="n">a9b</span><span class="o">-</span><span class="mi">45</span><span class="n">d7</span><span class="o">-</span><span class="n">aacc</span><span class="o">-</span><span class="mi">144</span><span class="n">d16322018</span><span class="o">=</span><span class="n">admin</span>
<span class="mi">1825</span><span class="n">efd3</span><span class="o">-</span><span class="mf">20e1</span><span class="o">-</span><span class="mi">4</span><span class="n">c18</span><span class="o">-</span><span class="mi">9648</span><span class="o">-</span><span class="mi">62</span><span class="n">c97d3ee5cb</span><span class="o">=</span><span class="n">sf</span>
<span class="n">ef18d7e7</span><span class="o">-</span><span class="mi">963</span><span class="n">b</span><span class="o">-</span><span class="mi">470</span><span class="n">f</span><span class="o">-</span><span class="mi">9230</span><span class="o">-</span><span class="n">c7f9de166888</span><span class="o">=</span><span class="n">topp</span>
</pre></div>
</div>
<p>This key provider also works for read only user/group services. Synchronizing adds new users not
having an entry in this file and removes entries for users deleted in the user/group service.</p>
</div>
<div class="section" id="key-provider-using-an-external-web-service">
<h3>Key provider using an external web service<a class="headerlink" href="#key-provider-using-an-external-web-service" title="Permalink to this headline">¶</a></h3>
<p>This key provider calls an external URL to map the authentication key to the user. This allows
GeoServer to integrate into an existing security infrastructure, where a session token is shared
among applications and managed through dedicated web services.</p>
<p>The web service URL and some other parameters can be specified to configure the mapper in detail:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Option</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Service</span> <span class="pre">URL,</span> <span class="pre">with</span> <span class="pre">key</span> <span class="pre">placeholder</span></code></p></td>
<td><p>the complete URL of the key mapping webservice, with a special placeholder ({key}) that will be replaced by the current authentication key</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Service</span> <span class="pre">Response</span> <span class="pre">User</span> <span class="pre">Search</span> <span class="pre">Regular</span> <span class="pre">Expression</span></code></p></td>
<td><p>a regular expression used to extract the username from the webservice response; the first matched group (the part included in parentheses) in the regular expression will be used as the username; the default (^\s*(.*)\s*$) takes all the response text, trimming spaces at both ends</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Connection</span> <span class="pre">Timeout</span></code></p></td>
<td><p>timeout to connect to the webservice</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Read</span> <span class="pre">Timeout</span></code></p></td>
<td><p>timeout to read data from the webservice</p></td>
</tr>
</tbody>
</table>
<p>The mapper will call the webservice using an HTTP GET request (webservice requiring POST are not
supported yet), replacing the {key} placeholder in the configured URL with the actual authentication
key.</p>
<p>If a response is received, it is parsed using the configured regular expression to extract the username
from it. New lines are automatically stripped from the response. Some examples of regular expression
that can be used are:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Regular Expression</strong></p></td>
<td><p><strong>Usage</strong></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">^\s*(.*)\s*$</span></code></p></td>
<td><p>all text trimming spaces at both ends</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">^.*?\&quot;user\&quot;\s*:\s*\&quot;([^\&quot;]+)\&quot;.*$</span></code></p></td>
<td><p>json response where the username is contained in a property named <strong>user</strong></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">^.*?&lt;username&gt;(.*?)&lt;/username&gt;.*$</span></code></p></td>
<td><p>xml response where the username is contained in a tag named <strong>username</strong></p></td>
</tr>
</tbody>
</table>
<p>Synchronizing users with the user/group service is not supported by this mapper.</p>
<div class="section" id="authkey-webservice-body-response-usergroup-service">
<h4>AuthKEY WebService Body Response UserGroup Service<a class="headerlink" href="#authkey-webservice-body-response-usergroup-service" title="Permalink to this headline">¶</a></h4>
<p>When using an external web service to get Auth details, it is possible to define a custom <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">UserGroup</span> <span class="pre">Service</span></code> being able to fetch Authorities - aka user’s Roles - from the HTTP Body Response.</p>
<p>The rationale is mostly the same; that kind of <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">UserGroup</span> <span class="pre">Service</span></code> will apply a <code class="docutils literal notranslate"><span class="pre">rolesRegex</span></code> - Roles Regular Expression - to the body response - which can be either XML, JSON or Plain Text/HTML - in order to fetch the list of available Authorities.</p>
<p>In order to do this, it is possible to configure instances of <strong>AuthKEY WebService Body Response</strong> User Group Service.</p>
<p>First thing to do is to:</p>
<ol class="arabic">
<li><p>Login as an <code class="docutils literal notranslate"><span class="pre">Administrator</span></code></p></li>
<li><p>Move to <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Users,</span> <span class="pre">Groups,</span> <span class="pre">Roles</span></code> and select <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">new</span></code> from <code class="docutils literal notranslate"><span class="pre">User</span> <span class="pre">Group</span> <span class="pre">Services</span></code></p>
<blockquote>
<div><div class="figure align-center">
<img alt="../../_images/001_user_group_service.png" src="../../_images/001_user_group_service.png" />
</div>
</div></blockquote>
</li>
<li><p>Click on <code class="docutils literal notranslate"><span class="pre">AuthKEY</span> <span class="pre">WebService</span> <span class="pre">Body</span> <span class="pre">Response</span></code></p>
<blockquote>
<div><div class="figure align-center">
<img alt="../../_images/002_user_group_service.png" src="../../_images/002_user_group_service.png" />
</div>
</div></blockquote>
</li>
<li><p>Provide a <code class="docutils literal notranslate"><span class="pre">Name</span></code> and select anything you want from <code class="docutils literal notranslate"><span class="pre">Passwords</span></code> - those won’t be used by this service, but they are still mandatory for GeoServer -</p>
<blockquote>
<div><div class="figure align-center">
<img alt="../../_images/003_user_group_service.png" src="../../_images/003_user_group_service.png" />
</div>
</div></blockquote>
</li>
<li><p>Provide a suitable <code class="docutils literal notranslate"><span class="pre">Roles</span> <span class="pre">Regex</span></code> to apply to your Web Service Response</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the only real mandatory value to provide. The others are optional and will allow you to customize the User Group Service behavior (see below)</p>
</div>
<div class="figure align-center">
<img alt="../../_images/004_user_group_service.png" src="../../_images/004_user_group_service.png" />
</div>
</div></blockquote>
</li>
</ol>
<p>Once the new <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">UserGroup</span> <span class="pre">Service</span></code> has been configured, it can be easily linked to the <code class="docutils literal notranslate"><span class="pre">Key</span> <span class="pre">Provider</span> <span class="pre">Web</span> <span class="pre">Service</span> <span class="pre">Mapper</span></code>.</p>
<ol class="arabic">
<li><p>From <code class="docutils literal notranslate"><span class="pre">Authentication</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Authentication</span> <span class="pre">Filters</span></code>, select - or add new - <code class="docutils literal notranslate"><span class="pre">AuthKEY</span></code> using <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Service</span></code> as key mapper</p></li>
<li><p>Select the newly defined <code class="docutils literal notranslate"><span class="pre">UserGroup</span> <span class="pre">Service</span></code> and save</p>
<blockquote>
<div><div class="figure align-center">
<img alt="../../_images/005_user_group_service.png" src="../../_images/005_user_group_service.png" />
</div>
</div></blockquote>
</li>
</ol>
<p><strong>Additional Options</strong></p>
<ol class="arabic">
<li><p><em>Optional static comma-separated list of available Groups from the Web Service response</em></p>
<blockquote>
<div><p>It is worth notice that this <code class="docutils literal notranslate"><span class="pre">UserGroup</span> <span class="pre">Service</span></code> will <strong>always</strong> translate fetched Roles in the form <code class="docutils literal notranslate"><span class="pre">ROLE_&lt;ROLENAME&gt;</span></code></p>
<p>As an instance, if the <code class="docutils literal notranslate"><span class="pre">Roles</span> <span class="pre">Regular</span> <span class="pre">Expression</span></code> will match something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_user_role1</span><span class="p">,</span> <span class="n">another_custom_user_role</span><span class="p">,</span> <span class="n">role_External_Role_X</span>
</pre></div>
</div>
<p>this will be converted into <strong>3</strong> different <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Roles</span></code> named as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ROLE_MY_USER_ROLE1</span>
<span class="n">ROLE_ANOTHER_CUSTOM_USER_ROLE</span>
<span class="n">ROLE_EXTERNAL_ROLE_X</span>
</pre></div>
</div>
<p>Of course the role names are known only at runtime; nevertheless it is possible to <strong>statically</strong> specify associated <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Groups</span></code> to be mapped later to other internal <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Roles</span></code>.</p>
<p>What does this mean? A <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Group</span></code> can be defined on the GeoServer Catalog and can be mapped by the active <code class="docutils literal notranslate"><span class="pre">Role</span> <span class="pre">Services</span></code> to one or more specific <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Roles</span></code>.</p>
<p>This mainly depends on the <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">Role</span> <span class="pre">Service</span></code> you use. By default, the internal <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">Role</span> <span class="pre">Service</span></code> can map Roles and Groups through static configuration stored on the GeoServer Data Dir.
This is possible by editing <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Group</span></code> details from the <code class="docutils literal notranslate"><span class="pre">Users,</span> <span class="pre">Groups,</span> <span class="pre">and</span> <span class="pre">Roles</span></code> panel</p>
<blockquote>
<div><div class="figure align-center">
<img alt="../../_images/006_user_group_service.png" src="../../_images/006_user_group_service.png" />
</div>
<div class="figure align-center">
<img alt="../../_images/007_user_group_service.png" src="../../_images/007_user_group_service.png" />
</div>
</div></blockquote>
<p>Now, this custom <code class="docutils literal notranslate"><span class="pre">UserGroup</span> <span class="pre">Service</span></code> maps dynamically <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Role</span></code> to <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Group</span></code> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ROLE_MY_USER_ROLE1</span>              <span class="o">&lt;&gt;</span> <span class="n">GROUP_MY_USER_ROLE1</span>
<span class="n">ROLE_ANOTHER_CUSTOM_USER_ROLE</span>   <span class="o">&lt;&gt;</span> <span class="n">GROUP_ANOTHER_CUSTOM_USER_ROLE</span>
<span class="n">ROLE_EXTERNAL_ROLE_X</span>            <span class="o">&lt;&gt;</span> <span class="n">GROUP_EXTERNAL_ROLE_X</span>
</pre></div>
</div>
<p>In order to be able to assign any <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Group</span></code> to other internal <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Roles</span></code>, since those are known only at runtime, the <code class="docutils literal notranslate"><span class="pre">UserGroup</span> <span class="pre">Service</span></code> allows us to <strong>statically</strong> specify the <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Groups</span></code> the Web Service can use;
this possible by setting the <code class="docutils literal notranslate"><span class="pre">Optional</span> <span class="pre">static</span> <span class="pre">comma-separated</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">available</span> <span class="pre">Groups</span> <span class="pre">from</span> <span class="pre">the</span> <span class="pre">Web</span> <span class="pre">Service</span> <span class="pre">response</span></code> option:</p>
<blockquote>
<div><div class="figure align-center">
<img alt="../../_images/008_user_group_service.png" src="../../_images/008_user_group_service.png" />
</div>
</div></blockquote>
<p>Once this is correctly configured, it will be possible to edit and assign <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Roles</span></code> to the Groups by using the standard way</p>
<blockquote>
<div><div class="figure align-center">
<img alt="../../_images/009_user_group_service.png" src="../../_images/009_user_group_service.png" />
</div>
</div></blockquote>
</div></blockquote>
</li>
<li><p><em>Role Service to use</em></p>
<blockquote>
<div><p>By default, if no <code class="docutils literal notranslate"><span class="pre">Role</span> <span class="pre">Service</span></code> specified, the <code class="docutils literal notranslate"><span class="pre">UserGroup</span> <span class="pre">Service</span></code> will use the <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">Active</span> <span class="pre">Role</span> <span class="pre">Service</span></code> to resolve <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Roles</span></code> from <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Groups</span></code> - as specified above -</p>
<blockquote>
<div><div class="figure align-center">
<img alt="../../_images/010_user_group_service.png" src="../../_images/010_user_group_service.png" />
</div>
</div></blockquote>
<p>It is possible to define a <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">Role</span> <span class="pre">Service</span></code> to use instead, to resole <code class="docutils literal notranslate"><span class="pre">GeoServer</span> <span class="pre">User</span> <span class="pre">Roles</span></code>; this is possible simply by selecting the <code class="docutils literal notranslate"><span class="pre">Role</span> <span class="pre">Service</span></code> to use from the <code class="docutils literal notranslate"><span class="pre">Role</span> <span class="pre">Service</span> <span class="pre">to</span> <span class="pre">use</span></code> option</p>
<blockquote>
<div><div class="figure align-center">
<img alt="../../_images/011_user_group_service.png" src="../../_images/011_user_group_service.png" />
</div>
</div></blockquote>
</div></blockquote>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Configuration can be done using the administrator GUI. There is a new type of authentication filter
named <strong>authkey</strong> offering the following options.</p>
<ol class="arabic simple">
<li><p>URL parameter name. This the name of URL parameter used in client HTTP requests. Default is <code class="docutils literal notranslate"><span class="pre">authkey</span></code>.</p></li>
<li><p>Key Provider. GeoServer offers the providers described above.</p></li>
<li><p>User/group service to be used.</p></li>
</ol>
<p>Some of the key providers can require additional configuration parameter. These will appear under the
Key Provider combobox when one of those is selected.</p>
<p>After configuring the filter it is necessary to put this filter on the authentication filter chain(s).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The administrator GUI for this filter has button <strong>Synchronize</strong>. Clicking on this button
saves the current configuration and triggers a synchronize. If users are added/removed from
the backing user/group service, the synchronize logic should be triggered.</p>
</div>
</div>
<div class="section" id="provider-pluggability">
<h2>Provider pluggability<a class="headerlink" href="#provider-pluggability" title="Permalink to this headline">¶</a></h2>
<p>With some Java programming it is possible to programmatically create and register a new key to user
name mapper that works under a different logic.
For example, you could have daily tokens, token generators and the like.</p>
<p>In order to provide your custom mapper you have to implement the <code class="docutils literal notranslate"><span class="pre">org.geoserver.security.AuthenticationKeyMapper</span></code>
interface and then register said bean in the Spring application context. Alternatively it is possible
to subclass from <code class="docutils literal notranslate"><span class="pre">org.geoserver.security.AbstractAuthenticationKeyMapper</span></code>. A mapper (key provider) has
to implement</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> *</span>
<span class="cm"> * Maps a unique authentication key to a username. Since usernames are</span>
<span class="cm"> * unique within a {@link GeoServerUserGroupService} an individual mapper</span>
<span class="cm"> * is needed for each service offering this feature.</span>
<span class="cm"> *</span>
<span class="cm"> * @author Andrea Aime - GeoSolution</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthenticationKeyMapper</span> <span class="kd">extends</span> <span class="n">BeanNameAware</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Maps the key provided in the request to the {@link GeoServerUser} object</span>
<span class="cm">     * of the corresponding user, or returns null</span>
<span class="cm">     * if no corresponding user is found</span>
<span class="cm">     *</span>
<span class="cm">     * Returns &lt;code&gt;null&lt;/code&gt; if the user is disabled</span>
<span class="cm">     *</span>
<span class="cm">     * @param key</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="n">GeoServerUser</span> <span class="nf">getUser</span><span class="p">(</span><span class="n">String</span> <span class="n">key</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Assures that each user in the corresponding {@link GeoServerUserGroupService} has</span>
<span class="cm">     * an authentication key.</span>
<span class="cm">     *</span>
<span class="cm">     * returns the number of added authentication keys</span>
<span class="cm">     *</span>
<span class="cm">     * @throws IOException</span>
<span class="cm">     */</span>
    <span class="kt">int</span> <span class="nf">synchronize</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Returns &lt;code&gt;true&lt;/code&gt; it the mapper can deal with read only u</span>
<span class="cm">     * user/group services</span>
<span class="cm">     *</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="nf">supportsReadOnlyUserGroupService</span><span class="p">();</span>

    <span class="n">String</span> <span class="nf">getBeanName</span><span class="p">();</span>

    <span class="kt">void</span> <span class="nf">setUserGroupServiceName</span><span class="p">(</span><span class="n">String</span> <span class="n">serviceName</span><span class="p">);</span>
    <span class="n">String</span> <span class="nf">getUserGroupServiceName</span><span class="p">();</span>

    <span class="kd">public</span> <span class="n">GeoServerSecurityManager</span> <span class="nf">getSecurityManager</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSecurityManager</span><span class="p">(</span><span class="n">GeoServerSecurityManager</span> <span class="n">securityManager</span><span class="p">);</span>

 <span class="p">}</span>
</pre></div>
</div>
<p>The mapper would have to be registered in the Spring application context in a <code class="docutils literal notranslate"><span class="pre">applicationContext.xml</span></code>
file in the root of your jar. Example for an implementation named <code class="docutils literal notranslate"><span class="pre">com.mycompany.security.SuperpowersMapper</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN//EN&quot; &quot;http://www.springframework.org/dtd/spring-beans.dtd&quot;&gt;</span>
<span class="nt">&lt;beans&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;superpowersMapper&quot;</span> <span class="na">class=</span><span class="s">&quot;com.mycompany.security.SuperpowersMapper&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<p>At this point you can drop the <code class="docutils literal notranslate"><span class="pre">authkey</span></code> jar along with your custom mapper jar and use it in the
administrator GUI of the authentication key filter.</p>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="../index.html" title="previous chapter">Extensions</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="../controlflow/index.html" title="next chapter">Control flow module</a></div>
      </div>
      </div><!-- /#content> -->
      <div id="content-right" class="content-border"></div>
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Key authentication module</a><ul>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
<li><a class="reference internal" href="#key-providers">Key providers</a><ul>
<li><a class="reference internal" href="#key-provider-using-user-properties">Key provider using user properties</a></li>
<li><a class="reference internal" href="#key-provider-using-a-property-file">Key provider using a property file</a></li>
<li><a class="reference internal" href="#key-provider-using-an-external-web-service">Key provider using an external web service</a><ul>
<li><a class="reference internal" href="#authkey-webservice-body-response-usergroup-service">AuthKEY WebService Body Response UserGroup Service</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#provider-pluggability">Provider pluggability</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="../index.html" title="previous chapter">Extensions</a></li>
            <li>Next: <a href="../controlflow/index.html" title="next chapter">Control flow module</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
                
        <li><a href="https://github.com/geoserver/geoserver/tree/master/doc/en/user/source/extensions/authkey/index.rst">Edit</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright 2021, Open Source Geospatial Foundation. License <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution</a>.
    Last updated on Jul 20, 2021.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>