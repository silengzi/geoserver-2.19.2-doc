<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>Apache Solr Tutorial &mdash; GeoServer 2.19.2 User Manual</title>
  <link rel="stylesheet" href="../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../_static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.19.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../_static/jquery.js"></script>
  <script type="text/javascript" src="../../_static/doctools.js"></script>
  <script type="text/javascript" src="../../_static/searchtools.js"></script>
  <script type="text/javascript" src="../../searchindex.js"></script>
  <link rel="shortcut icon" href="../../_static/geoserver.ico"/>
      <link rel="search" title="Search" href="../../search.html" />
      <link rel="top" title="GeoServer 2.19.2 User Manual" href="../../index.html" />
      <link rel="up" title="Application schemas" href="index.html" />
      <link rel="next" title="Styling" href="../../styling/index.html" />
      <link rel="prev" title="MongoDB Tutorial" href="mongo-tutorial.html" />
</head>
<body class="data/app-schema/solr-tutorial">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../index.html">GeoServer 2.19.2 User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/about">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/download">Download</a></li>
        <!--<li><a href="../../index.html">Documentation</a></li>-->
      </ul>
        <form id="quick-search" action="../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../_static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content-left" class="content-border"></div>
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../index.html">GeoServer 2.19.2 User Manual</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Data management</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Application schemas</a> &raquo;</li>
  <li>Apache Solr Tutorial</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../../py-modindex.html" title="Python Module Index"
       accesskey="">modules</a></li>
  <li>
    <a href="../../styling/index.html" title="Styling"
       accesskey="N">next</a>|</li>
  <li>
    <a href="mongo-tutorial.html" title="MongoDB Tutorial"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="apache-solr-tutorial">
<span id="solr-tutorial"></span><h1>Apache Solr Tutorial<a class="headerlink" href="#apache-solr-tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial demonstrates how to use the App-Schema plugin with a Apache Solr data store. This tutorial will focus on the Apache Solr data store specific aspects, and the <a class="reference external" href="_app-schema">App-Schema documentation</a> should be read first.</p>
<p>The use case for this tutorial will be to serve through App-Schema the information about some meteorological stations index in an Apache Solr core. Note that this use case is completely fictional and only used to demonstrate the Apache Solr and App-Schema integration.</p>
<p>A station data is composed of some meta-information about the station, e.g. it’s name and position. The only extra different configuration we need to provide when using Apache Solr as a data source is the configuration of the data store itself.</p>
<p>Apache Solr data source configuration as a specific syntax and allow us to specify geometry attributes and to explicitly set the default geometry:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;sourceDataStores&gt;</span>
  <span class="nt">&lt;SolrDataStore&gt;</span>
    <span class="nt">&lt;id&gt;</span>stations<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;url&gt;</span>http://localhost:8983/solr/stations<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;stations&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;geometry</span> <span class="na">default=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;name&gt;</span>location<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;srid&gt;</span>4326<span class="nt">&lt;/srid&gt;</span>
        <span class="nt">&lt;type&gt;</span>POINT<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/index&gt;</span>
  <span class="nt">&lt;/SolrDataStore&gt;</span>
<span class="nt">&lt;/sourceDataStores&gt;</span>
</pre></div>
</div>
<p>In this particular case the the <code class="docutils literal notranslate"><span class="pre">location</span></code> attribute contains a point geometry and will be the default geometry.</p>
<p>The complete mapping file is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="nt">&lt;as:AppSchemaDataAccess</span> <span class="na">xmlns:as=</span><span class="s">&quot;http://www.geotools.org/app-schema&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;namespaces&gt;</span>
        <span class="nt">&lt;Namespace&gt;</span>
            <span class="nt">&lt;prefix&gt;</span>st<span class="nt">&lt;/prefix&gt;</span>
            <span class="nt">&lt;uri&gt;</span>http://www.stations.org/1.0<span class="nt">&lt;/uri&gt;</span>
        <span class="nt">&lt;/Namespace&gt;</span>
        <span class="nt">&lt;Namespace&gt;</span>
            <span class="nt">&lt;prefix&gt;</span>gml<span class="nt">&lt;/prefix&gt;</span>
            <span class="nt">&lt;uri&gt;</span>http://www.opengis.net/gml/3.2<span class="nt">&lt;/uri&gt;</span>
        <span class="nt">&lt;/Namespace&gt;</span>
    <span class="nt">&lt;/namespaces&gt;</span>
    <span class="nt">&lt;sourceDataStores&gt;</span>
        <span class="nt">&lt;SolrDataStore&gt;</span>
            <span class="nt">&lt;id&gt;</span>stations<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;url&gt;</span>http://localhost:8983/solr/stations<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;stations&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;geometry</span> <span class="na">default=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;name&gt;</span>location<span class="nt">&lt;/name&gt;</span>
                    <span class="nt">&lt;srid&gt;</span>4326<span class="nt">&lt;/srid&gt;</span>
                    <span class="nt">&lt;type&gt;</span>POINT<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;/geometry&gt;</span>
            <span class="nt">&lt;/index&gt;</span>
        <span class="nt">&lt;/SolrDataStore&gt;</span>
    <span class="nt">&lt;/sourceDataStores&gt;</span>
    <span class="nt">&lt;targetTypes&gt;</span>
        <span class="nt">&lt;FeatureType&gt;</span>
            <span class="nt">&lt;schemaUri&gt;</span>stations.xsd<span class="nt">&lt;/schemaUri&gt;</span>
        <span class="nt">&lt;/FeatureType&gt;</span>
    <span class="nt">&lt;/targetTypes&gt;</span>
    <span class="nt">&lt;typeMappings&gt;</span>
        <span class="nt">&lt;FeatureTypeMapping&gt;</span>
            <span class="nt">&lt;mappingName&gt;</span>stations_solr<span class="nt">&lt;/mappingName&gt;</span>
            <span class="nt">&lt;sourceDataStore&gt;</span>stations<span class="nt">&lt;/sourceDataStore&gt;</span>
            <span class="nt">&lt;sourceType&gt;</span>stations<span class="nt">&lt;/sourceType&gt;</span>
            <span class="nt">&lt;targetElement&gt;</span>st:Station<span class="nt">&lt;/targetElement&gt;</span>
            <span class="nt">&lt;attributeMappings&gt;</span>
                <span class="nt">&lt;AttributeMapping&gt;</span>
                    <span class="nt">&lt;targetAttribute&gt;</span>st:Station<span class="nt">&lt;/targetAttribute&gt;</span>
                    <span class="nt">&lt;idExpression&gt;</span>
                        <span class="nt">&lt;OCQL&gt;</span>station_id<span class="nt">&lt;/OCQL&gt;</span>
                    <span class="nt">&lt;/idExpression&gt;</span>
                <span class="nt">&lt;/AttributeMapping&gt;</span>
                <span class="nt">&lt;AttributeMapping&gt;</span>
                    <span class="nt">&lt;targetAttribute&gt;</span>st:stationName<span class="nt">&lt;/targetAttribute&gt;</span>
                    <span class="nt">&lt;sourceExpression&gt;</span>
                        <span class="nt">&lt;OCQL&gt;</span>station_name<span class="nt">&lt;/OCQL&gt;</span>
                    <span class="nt">&lt;/sourceExpression&gt;</span>
                <span class="nt">&lt;/AttributeMapping&gt;</span>
                <span class="nt">&lt;AttributeMapping&gt;</span>
                    <span class="nt">&lt;targetAttribute&gt;</span>st:position<span class="nt">&lt;/targetAttribute&gt;</span>
                    <span class="nt">&lt;sourceExpression&gt;</span>
                        <span class="nt">&lt;OCQL&gt;</span>station_location<span class="nt">&lt;/OCQL&gt;</span>
                    <span class="nt">&lt;/sourceExpression&gt;</span>
                <span class="nt">&lt;/AttributeMapping&gt;</span>
            <span class="nt">&lt;/attributeMappings&gt;</span>
        <span class="nt">&lt;/FeatureTypeMapping&gt;</span>
    <span class="nt">&lt;/typeMappings&gt;</span>
<span class="nt">&lt;/as:AppSchemaDataAccess&gt;</span>
</pre></div>
</div>
<p>The mappings for the attributes are straightforward and follow the normal App-Schema attributes mappings syntax. Currently multi valued fields are not supported.</p>
<div class="section" id="using-solr-as-app-schema-indexes">
<h2>Using Solr as App-Schema Indexes<a class="headerlink" href="#using-solr-as-app-schema-indexes" title="Permalink to this headline">¶</a></h2>
<p>App-Schema Indexes is an extension for mapping that allows to use Apache Solr as Index for queries and retrieving data from normal App-Schema datasource (SQL DB, MongoDB, … ).</p>
<p>The only requirement to use it is having Geoserver App-Schema extension and Solr extension installed.</p>
<div class="section" id="how-index-layer-works">
<h3>How Index layer works<a class="headerlink" href="#how-index-layer-works" title="Permalink to this headline">¶</a></h3>
<p>When App-Schema detects the index layer is activated for a FeatureType, it will use Solr configured fields for every query incoming from Geoserver OWS requests.  If the incoming query uses only indexed fields App-Schema will query only on Solr data source for retrieving matching features IDs and will connect to normal data source to get all in depth data but exclusively for matching IDs.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>note that both Primary Keys (solr index core and data source) should match to get Index layer working.</p>
</div>
</div>
<div class="section" id="linking-an-index-only-store">
<h3>Linking an index only store<a class="headerlink" href="#linking-an-index-only-store" title="Permalink to this headline">¶</a></h3>
<p>Begin creating the SolrDataStore definition as usual along with the Postgis store definition:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span>(...)
<span class="nt">&lt;sourceDataStores&gt;</span>
(...)
    <span class="nt">&lt;SolrDataStore&gt;</span>
        <span class="nt">&lt;id&gt;</span>stations_index<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;url&gt;</span>http://localhost:8983/solr/stations<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;stations&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;geometry</span> <span class="na">default=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;name&gt;</span>location<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;srid&gt;</span>4326<span class="nt">&lt;/srid&gt;</span>
                <span class="nt">&lt;type&gt;</span>POINT<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;/geometry&gt;</span>
        <span class="nt">&lt;/index&gt;</span>
    <span class="nt">&lt;/SolrDataStore&gt;</span>
     <span class="nt">&lt;DataStore&gt;</span>
          <span class="nt">&lt;id&gt;</span>postgis_dataStore<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;parameters&gt;</span>
              <span class="nt">&lt;Parameter&gt;</span>
                  <span class="nt">&lt;name&gt;</span>Connection timeout<span class="nt">&lt;/name&gt;</span>
                  <span class="nt">&lt;value&gt;</span>20<span class="nt">&lt;/value&gt;</span>
              <span class="nt">&lt;/Parameter&gt;</span>
              <span class="nt">&lt;Parameter&gt;</span>
                  <span class="nt">&lt;name&gt;</span>port<span class="nt">&lt;/name&gt;</span>
                  <span class="nt">&lt;value&gt;</span>5432<span class="nt">&lt;/value&gt;</span>
              <span class="nt">&lt;/Parameter&gt;</span>
              <span class="nt">&lt;Parameter&gt;</span>
                  <span class="nt">&lt;name&gt;</span>passwd<span class="nt">&lt;/name&gt;</span>
                  <span class="nt">&lt;value&gt;</span>postgres<span class="nt">&lt;/value&gt;</span>
              <span class="nt">&lt;/Parameter&gt;</span>
              <span class="nt">&lt;Parameter&gt;</span>
                  <span class="nt">&lt;name&gt;</span>dbtype<span class="nt">&lt;/name&gt;</span>
                  <span class="nt">&lt;value&gt;</span>postgis<span class="nt">&lt;/value&gt;</span>
              <span class="nt">&lt;/Parameter&gt;</span>
(...)
</pre></div>
</div>
<p>Link a solr index as index layer on FeatureTypeMapping setting:</p>
<ul class="simple">
<li><p>indexDataStore : The SolrDataStore id property from the store you use as index layer only.</p></li>
<li><p>indexType : The solr core to use.</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;typeMappings&gt;</span>
(...)
    <span class="nt">&lt;FeatureTypeMapping&gt;</span>
        <span class="nt">&lt;mappingName&gt;</span>Stations<span class="nt">&lt;/mappingName&gt;</span>
        <span class="nt">&lt;sourceDataStore&gt;</span>postgis_dataStore<span class="nt">&lt;/sourceDataStore&gt;</span>
        <span class="nt">&lt;sourceType&gt;</span>meteo_stations<span class="nt">&lt;/sourceType&gt;</span>
        <span class="nt">&lt;targetElement&gt;</span>st:Station<span class="nt">&lt;/targetElement&gt;</span>
        <span class="nt">&lt;defaultGeometry&gt;</span>st:position<span class="nt">&lt;/defaultGeometry&gt;</span>
        <span class="nt">&lt;indexDataStore&gt;</span>stations_index<span class="nt">&lt;/indexDataStore&gt;</span>
        <span class="nt">&lt;indexType&gt;</span>stations<span class="nt">&lt;/indexType&gt;</span>
        <span class="nt">&lt;attributeMappings&gt;</span>
        (...)
</pre></div>
</div>
</div>
<div class="section" id="linking-an-index-enabled-attribute">
<h3>Linking an index enabled attribute<a class="headerlink" href="#linking-an-index-enabled-attribute" title="Permalink to this headline">¶</a></h3>
<p>To link a solr core field as index for an AttributeMapping you only need to add an indexField definition with this format:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;AttributeMapping&gt;</span>
(...)
  <span class="nt">&lt;indexField&gt;</span>${SOLR_FIELD_NAME}<span class="nt">&lt;/indexField&gt;</span>
(...)
<span class="nt">&lt;/AttributeMapping&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>${SOLR_FIELD_NAME} : The field name from solr core to use in index layer.</p></li>
</ul>
<p>For example if you need to use solr fields: station_id and station_name; you will write on mapping:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;AttributeMapping&gt;</span>
    <span class="nt">&lt;targetAttribute&gt;</span>st:Station<span class="nt">&lt;/targetAttribute&gt;</span>
    <span class="nt">&lt;idExpression&gt;</span>
        <span class="nt">&lt;OCQL&gt;</span>id<span class="nt">&lt;/OCQL&gt;</span>
    <span class="nt">&lt;/idExpression&gt;</span>
    <span class="nt">&lt;indexField&gt;</span>station_id<span class="nt">&lt;/indexField&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
<span class="nt">&lt;AttributeMapping&gt;</span>
    <span class="nt">&lt;targetAttribute&gt;</span>st:stationName<span class="nt">&lt;/targetAttribute&gt;</span>
    <span class="nt">&lt;sourceExpression&gt;</span>
        <span class="nt">&lt;OCQL&gt;</span>strConcat(&#39;1_&#39;, common_name)<span class="nt">&lt;/OCQL&gt;</span>
    <span class="nt">&lt;/sourceExpression&gt;</span>
    <span class="nt">&lt;indexField&gt;</span>station_name<span class="nt">&lt;/indexField&gt;</span>
<span class="nt">&lt;/AttributeMapping&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="mongo-tutorial.html" title="previous chapter">MongoDB Tutorial</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="../../styling/index.html" title="next chapter">Styling</a></div>
      </div>
      </div><!-- /#content> -->
      <div id="content-right" class="content-border"></div>
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Apache Solr Tutorial</a><ul>
<li><a class="reference internal" href="#using-solr-as-app-schema-indexes">Using Solr as App-Schema Indexes</a><ul>
<li><a class="reference internal" href="#how-index-layer-works">How Index layer works</a></li>
<li><a class="reference internal" href="#linking-an-index-only-store">Linking an index only store</a></li>
<li><a class="reference internal" href="#linking-an-index-enabled-attribute">Linking an index enabled attribute</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="mongo-tutorial.html" title="previous chapter">MongoDB Tutorial</a></li>
            <li>Next: <a href="../../styling/index.html" title="next chapter">Styling</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
                
        <li><a href="https://github.com/geoserver/geoserver/tree/master/doc/en/user/source/data/app-schema/solr-tutorial.rst">Edit</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright 2021, Open Source Geospatial Foundation. License <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution</a>.
    Last updated on Jul 20, 2021.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>