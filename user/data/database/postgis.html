<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <title>PostGIS &mdash; GeoServer 2.19.2 User Manual</title>
  <link rel="stylesheet" href="../../static/blueprint/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../../static/blueprint/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="../../static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="../../static/default.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.19.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <script type="text/javascript" src="../../static/jquery.js"></script>
  <script type="text/javascript" src="../../static/doctools.js"></script>
  <script type="text/javascript" src="../../static/searchtools.js"></script>
  <script type="text/javascript" src="../../searchindex.js"></script>
  <link rel="shortcut icon" href="../../static/geoserver.ico"/>
      <link rel="search" title="Search" href="../../search.html" />
      <link rel="top" title="GeoServer 2.19.2 User Manual" href="../../index.html" />
      <link rel="up" title="Databases" href="index.html" />
      <link rel="next" title="H2" href="h2.html" />
      <link rel="prev" title="Databases" href="index.html" />
</head>
<body class="data/database/postgis">
  <div id="header" class="selfclear">
    <div class="wrap selfclear">
      <div id="logo"><a href="../../index.html">GeoServer 2.19.2 User Manual</a></div>
      <ul id="top-nav">
        <li class="first"><a href="http://geoserver.org/about">About</a></li>
        <li><a href="http://blog.geoserver.org/">Blog</a></li>
        <li><a href="http://geoserver.org/download">Download</a></li>
        <!--<li><a href="../../index.html">Documentation</a></li>-->
      </ul>
        <form id="quick-search" action="../../search.html" method="get">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
            <input id="quick-search-submit" type="image" value="Search" src="../../static/chrome/search_icon_green.png" />
          </fieldset>
        </form>
    </div><!-- /.wrap -->
  </div><!-- /#header -->
  <div id="main">
    <div class="wrap selfclear">
      <div id="content-left" class="content-border"></div>
      <div id="content">
<ul id="breadcrumbs">
  
  <li><a href="../../index.html">GeoServer 2.19.2 User Manual</a> &raquo;</li>
  <li><a href="../index.html" accesskey="U">Data management</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Databases</a> &raquo;</li>
  <li>PostGIS</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../../py-modindex.html" title="Python Module Index"
       accesskey="">modules</a></li>
  <li>
    <a href="h2.html" title="H2"
       accesskey="N">next</a>|</li>
  <li>
    <a href="index.html" title="Databases"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="postgis">
<span id="data-postgis"></span><h1>PostGIS<a class="headerlink" href="#postgis" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://postgis.net">PostGIS</a> is an open source spatial database based on <a class="reference external" href="http://postgresql.com/">PostgreSQL</a>, and is currently one of the most popular open source spatial databases today.</p>
<div class="section" id="adding-a-postgis-database">
<h2>Adding a PostGIS database<a class="headerlink" href="#adding-a-postgis-database" title="Permalink to this headline">¶</a></h2>
<p>As with all formats, adding a shapefile to GeoServer involves adding a new store to the existing <a class="reference internal" href="../webadmin/stores.html#data-webadmin-stores"><span class="std std-ref">Stores</span></a>  through the <a class="reference internal" href="../../webadmin/index.html#web-admin"><span class="std std-ref">Web administration interface</span></a>.</p>
<div class="section" id="using-default-connection">
<h3>Using default connection<a class="headerlink" href="#using-default-connection" title="Permalink to this headline">¶</a></h3>
<p>To begin, navigate to <span class="menuselection">Stores ‣ Add a new store ‣ PostGIS NG</span>.</p>
<p>Fill in the <em>Basic Store Info</em> used to identify the database when managing layers.</p>
<div class="figure align-default" id="id3">
<img alt="../../_images/postgis-basic-info.png" src="../../_images/postgis-basic-info.png" />
<p class="caption"><span class="caption-text"><em>Adding a PostGIS database</em></span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Basic Store Info</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="guilabel">Workspace</span></p></td>
<td><p>Name of the workspace to contain the database.  This will also be the prefix of any layer names created from tables in the database.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Data Source Name</span></p></td>
<td><p>Name of the database.  This can be different from the name as known to PostgreSQL/PostGIS.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">Description</span></p></td>
<td><p>Description of the database/store.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Enabled</span></p></td>
<td><p>Enables the store.  If disabled, no data in the database will be served.</p></td>
</tr>
</tbody>
</table>
<p>Move on to the connection parameters used to connect and interact with the database.</p>
<div class="figure align-center" id="id4">
<img alt="../../_images/postgis.png" src="../../_images/postgis.png" />
<p class="caption"><span class="caption-text"><em>PostGIS connection parameters</em></span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">dbtype</span></code> and <code class="docutils literal notranslate"><span class="pre">namespace</span></code> connection parameters are not directly editable. The <span class="guilabel">dbtype</span> parameter is for internal use only (and only accessable via the REST API).</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Connection Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="guilabel">dbtype</span></p></td>
<td><p>Type of database.  Internal value, leave this value as the default.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">namespace</span></p></td>
<td><p>Namespace to be associated with the database.  This field is altered by changing the workspace name.</p></td>
</tr>
</tbody>
</table>
<p>Connection parameters establishing a database connection (see <a class="reference internal" href="connection-pooling.html"><span class="doc">Database Connection Pooling</span></a>):</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Connection Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="guilabel">host</span></p></td>
<td><p>Host name where the database exists.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">port</span></p></td>
<td><p>Port number to connect to the above host.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">database</span></p></td>
<td><p>Name of the database as known on the host.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">schema</span></p></td>
<td><p>Schema in the above database.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">user</span></p></td>
<td><p>User name to connect to the database.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">passwd</span></p></td>
<td><p>Password associated with the above user.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">max connections</span></p></td>
<td><p>Maximum amount of open connections to the database.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">min connections</span></p></td>
<td><p>Minimum number of pooled connections.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">fetch size</span></p></td>
<td><p>Number of records read with each interaction with the database.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Connection timeout</span></p></td>
<td><p>Time (in seconds) the connection pool will wait before timing out.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">validate connections</span></p></td>
<td><p>Checks the connection is alive before using it.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Evictor run periodicity</span></p></td>
<td><p>Number of seconds between idle object evictor runs.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">Max connection idle time</span></p></td>
<td><p>Number of seconds a connection needs to stay idle before the evictor starts to consider closing it.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Evictor tests per run</span></p></td>
<td><p>Number of connections checked by the idle connection evictor for each of its runs.</p></td>
</tr>
</tbody>
</table>
<p>Connection parameters managing SQL generation:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Connection Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="guilabel">Expose primary keys</span></p></td>
<td><p>Expose primary key columns as values suitable for filtering.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Primary key metadata table</span></p></td>
<td><p>Provide table defining how primary keys values are generated (see <a class="reference internal" href="primarykey.html"><span class="doc">Controlling feature ID generation in spatial databases</span></a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">Session startup SQL</span></p></td>
<td><p>SQL applied to connection before use (see <a class="reference internal" href="sqlsession.html"><span class="doc">Custom SQL session start/stop scripts</span></a>)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Session close-up SQL</span></p></td>
<td><p>SQL applied to connection after use (see <a class="reference internal" href="sqlsession.html"><span class="doc">Custom SQL session start/stop scripts</span></a>)</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">preparedStatements</span></p></td>
<td><p>Enables prepared statements for SQL generation, rather than text substitution.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Max open prepared statements</span></p></td>
<td><p>Number of prepared statements available.</p></td>
</tr>
</tbody>
</table>
<p>Connection parameters managing database interaction:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Connection Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="guilabel">Loose bbox</span></p></td>
<td><p>Performs only the primary filter on the bounding box.  See the section on <a class="reference internal" href="#postgis-loose-bbox"><span class="std std-ref">Using loose bounding box</span></a> for details.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Estimated extends</span></p></td>
<td><p>Use spatial index to quickly estimate bounds, rather than check every row.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">Encode functions</span></p></td>
<td><p>Generate supported filter functions into their SQL equivalent.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Support on the fly geometry simplification</span></p></td>
<td><p>Enables use of PostGIS geometry simplification</p></td>
</tr>
</tbody>
</table>
<p>Connection parameters supporting initial database creation:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Connection Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="guilabel">create database</span></p></td>
<td><p>Enable to define a new database on connection</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">create database params</span></p></td>
<td><p>Additional CREATE DATABASE definition, example <kbd class="kbd docutils literal notranslate">WITH TEMPLATE=postgis</kbd></p></td>
</tr>
</tbody>
</table>
<p>When finished, click <span class="guilabel">Save</span>.</p>
</div>
<div class="section" id="using-jndi">
<h3>Using JNDI<a class="headerlink" href="#using-jndi" title="Permalink to this headline">¶</a></h3>
<p>GeoServer can also connect to a PostGIS database using <a class="reference external" href="http://java.sun.com/products/jndi/">JNDI</a> (Java Naming and Directory Interface).</p>
<p>To begin, navigate to <span class="menuselection">Stores ‣ Add a new store ‣ PostGIS NG (JNDI)</span>.</p>
<div class="figure align-center" id="id5">
<img alt="../../_images/postgisjndi.png" src="../../_images/postgisjndi.png" />
<p class="caption"><span class="caption-text"><em>Adding a PostGIS database (using JNDI)</em></span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="guilabel">Workspace</span></p></td>
<td><p>Name of the workspace to contain the store.  This will also be the prefix of all of the layer names created from the store.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Data Source Name</span></p></td>
<td><p>Name of the database.  This can be different from the name as known to PostgreSQL/PostGIS.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">Description</span></p></td>
<td><p>Description of the database/store.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">Enabled</span></p></td>
<td><p>Enables the store.  If disabled, no data in the database will be served.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">dbtype</span></p></td>
<td><p>Type of database.  Leave this value as the default.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">jndiReferenceName</span></p></td>
<td><p>JNDI path to the database.</p></td>
</tr>
<tr class="row-even"><td><p><span class="guilabel">schema</span></p></td>
<td><p>Schema for the above database.</p></td>
</tr>
<tr class="row-odd"><td><p><span class="guilabel">namespace</span></p></td>
<td><p>Namespace to be associated with the database.  This field is altered by changing the workspace name.</p></td>
</tr>
</tbody>
</table>
<p>When finished, click <span class="guilabel">Save</span>.</p>
</div>
</div>
<div class="section" id="configuring-postgis-layers">
<h2>Configuring PostGIS layers<a class="headerlink" href="#configuring-postgis-layers" title="Permalink to this headline">¶</a></h2>
<p>When properly loaded, all tables in the database will be visible to GeoServer, but they will need to be individually configured before being served by GeoServer.  See the section on <a class="reference internal" href="../webadmin/layers.html#data-webadmin-layers"><span class="std std-ref">Layers</span></a> for how to add and edit new layers.</p>
</div>
<div class="section" id="using-loose-bounding-box">
<span id="postgis-loose-bbox"></span><h2>Using loose bounding box<a class="headerlink" href="#using-loose-bounding-box" title="Permalink to this headline">¶</a></h2>
<p>When the option <span class="guilabel">loose bbox</span> is enabled, only the bounding box of a geometry is used.  This can result in a significant performance gain, but at the expense of total accuracy; some geometries may be considered inside of a bounding box when they are technically not.</p>
<p>If primarily connecting to this data via WMS, this flag can be set safely since a loss of some accuracy is usually acceptable. However, if using WFS and especially if making use of BBOX filtering capabilities, this flag should not be set.</p>
</div>
<div class="section" id="publishing-a-postgis-view">
<h2>Publishing a PostGIS view<a class="headerlink" href="#publishing-a-postgis-view" title="Permalink to this headline">¶</a></h2>
<p>Publishing a view follows the same process as publishing a table. The only additional step is to manually ensure that the view has an entry in the <code class="docutils literal notranslate"><span class="pre">geometry_columns</span></code> table.</p>
<p>For example consider a table with the schema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_table</span><span class="p">(</span> <span class="nb">id</span> <span class="nb">int</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span> <span class="n">name</span> <span class="n">VARCHAR</span><span class="p">,</span> <span class="n">the_geom</span> <span class="n">GEOMETRY</span> <span class="p">)</span>
</pre></div>
</div>
<p>Consider also the following view:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">my_view</span> <span class="k">as</span> <span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span> <span class="n">the_geom</span> <span class="n">FROM</span> <span class="n">my_table</span><span class="p">;</span>
</pre></div>
</div>
<p>Before this view can be served by GeoServer, the following step is necessary to manually create the <code class="docutils literal notranslate"><span class="pre">geometry_columns</span></code> entry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">geometry_columns</span> <span class="n">VALUES</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;public&#39;</span><span class="p">,</span><span class="s1">&#39;my_view&#39;</span><span class="p">,</span><span class="s1">&#39;my_geom&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4326</span><span class="p">,</span> <span class="s1">&#39;POINT&#39;</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="performance-considerations">
<h2>Performance considerations<a class="headerlink" href="#performance-considerations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="geos">
<h3>GEOS<a class="headerlink" href="#geos" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://trac.osgeo.org/geos/">GEOS</a> (Geometry Engine, Open Source) is an optional component of a PostGIS installation.  It is recommended that GEOS be installed with any PostGIS instance used by GeoServer, as this allows GeoServer to make use of its functionality when doing spatial operations.  When GEOS is not available, these operations are performed internally which can result in degraded performance.</p>
</div>
<div class="section" id="spatial-indexing">
<h3>Spatial indexing<a class="headerlink" href="#spatial-indexing" title="Permalink to this headline">¶</a></h3>
<p>It is strongly recommended to create a spatial index on tables with a spatial component (i.e. containing a geometry column).  Any table of which does not have a spatial index will likely respond slowly to queries.</p>
</div>
</div>
<div class="section" id="common-problems">
<h2>Common problems<a class="headerlink" href="#common-problems" title="Permalink to this headline">¶</a></h2>
<div class="section" id="primary-keys">
<h3>Primary keys<a class="headerlink" href="#primary-keys" title="Permalink to this headline">¶</a></h3>
<p>In order to enable transactional extensions on a table (for transactional WFS), the table must have a primary key.  A table without a primary key is considered read-only to GeoServer.</p>
<p>GeoServer has an option to expose primary key values (to make filters easier). Please keep in mind that these values are only exposed for your convenience - any attempted to modify these values using WFS-T update will be silently ignored. This restriction is in place as the primary key value is used to define the FeatureId. If you must change the FeatureId you can use WFS-T delete and add in a single Transaction request to define a replacement feature.</p>
</div>
<div class="section" id="multi-line">
<h3>Multi-line<a class="headerlink" href="#multi-line" title="Permalink to this headline">¶</a></h3>
<p>To insert multi-line text (for use with labeling) remember to use escaped text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">place</span> <span class="n">VALUES</span> <span class="p">(</span><span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">&#39;POINT(-71.060316 48.432044)&#39;</span><span class="p">,</span> <span class="mi">4326</span><span class="p">),</span> <span class="n">E</span><span class="s1">&#39;Westfield</span><span class="se">\n</span><span class="s1">Tower&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="jsonpointer-function-support">
<h2>JsonPointer Function support<a class="headerlink" href="#jsonpointer-function-support" title="Permalink to this headline">¶</a></h2>
<p>GeoServer is able to translate the <code class="docutils literal notranslate"><span class="pre">jsonPointer</span></code> function to a query using PostgreSQL support for JSON types.
The following are the main characteristics of the implementation:</p>
<ul class="simple">
<li><p>The jsonPointer function syntax is like the following: <code class="docutils literal notranslate"><span class="pre">jsonPointer(attributeName,'/path/to/json/attribute')</span></code>.</p></li>
<li><p>The function is able to select attributes inside json arrays by specifying the index of the target element in the json path eg. <code class="docutils literal notranslate"><span class="pre">'/path/to/array/element/0'</span></code>.</p></li>
<li><p>When accessing a JSON property it is implicitly assumed that the same property will have the same type on all features, otherwise a cast exception will be thrown by the database.</p></li>
<li><p>GeoServer will perform a cast automatically to the expect type from the evaluation; the cast is completely delegated to the database.</p></li>
<li><p>If the property doesn’t exists no errors will be issued, but the features that have that property will be excluded; hence the property we whish to query is not mandatory in all features.</p></li>
</ul>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>Having a json column storing jsonvalues like the following,</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;city name&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;the city description&quot;</span><span class="p">,</span>
  <span class="nt">&quot;districts&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
     <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;district1&quot;</span><span class="p">,</span>
     <span class="nt">&quot;population&quot;</span><span class="p">:</span> <span class="mi">2000</span>
    <span class="p">},</span>
    <span class="p">{</span>
     <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;district2&quot;</span><span class="p">,</span>
     <span class="nt">&quot;population&quot;</span><span class="p">:</span> <span class="mi">5000</span>
    <span class="p">}</span>
  <span class="p">]</span>
  <span class="s2">&quot;population&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;average_age&quot;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
    <span class="nt">&quot;toal&quot;</span><span class="p">:</span> <span class="mi">50000</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and assuming an attribute name as <code class="docutils literal notranslate"><span class="pre">city</span></code>, valid jsonPointer functions would be:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jsonPointer(city,</span> <span class="pre">'/name')</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jsonPointer(city,</span> <span class="pre">'/population/average_age')</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jsonPointer(city,</span> <span class="pre">'/districts/0/name')</span></code>.</p></li>
</ul>
<p>An example cql_filter would then be <code class="docutils literal notranslate"><span class="pre">jsonPointer(city,</span> <span class="pre">'/population/average_age')</span> <span class="pre">&gt;</span> <span class="pre">30</span></code>.</p>
<p>While an example rule in a sld style sheet could be:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Rule&gt;</span>
  <span class="nt">&lt;Name&gt;</span>Cities<span class="nt">&lt;/Name&gt;</span>
     <span class="nt">&lt;ogc:Filter&gt;</span>
       <span class="nt">&lt;ogc:PropertyIsEqualTo&gt;</span>
         <span class="nt">&lt;ogc:Function</span> <span class="na">name=</span><span class="s">&quot;jsonPointer&quot;</span><span class="nt">&gt;</span>
           <span class="nt">&lt;ogc:PropertyName&gt;</span>city<span class="nt">&lt;/ogc:PropertyName&gt;</span>
           <span class="nt">&lt;ogc:Literal&gt;</span>/population/average_age<span class="nt">&lt;/ogc:Literal&gt;</span>
         <span class="nt">&lt;/ogc:Function&gt;</span>
         <span class="nt">&lt;ogc:Literal&gt;</span>35<span class="nt">&lt;/ogc:Literal&gt;</span>
       <span class="nt">&lt;/ogc:PropertyIsEqualTo&gt;</span>
       <span class="nt">&lt;/ogc:Filter&gt;</span>
     <span class="nt">&lt;PointSymbolizer&gt;</span>
       <span class="nt">&lt;Graphic&gt;</span>
         <span class="nt">&lt;Mark&gt;</span>
           <span class="nt">&lt;WellKnownName&gt;</span>square<span class="nt">&lt;/WellKnownName&gt;</span>
             <span class="nt">&lt;Fill&gt;</span>
               <span class="nt">&lt;CssParameter</span> <span class="na">name=</span><span class="s">&quot;fill&quot;</span><span class="nt">&gt;</span>#FF0000<span class="nt">&lt;/CssParameter&gt;</span>
             <span class="nt">&lt;/Fill&gt;</span>
         <span class="nt">&lt;/Mark&gt;</span>
         <span class="nt">&lt;Size&gt;</span>16<span class="nt">&lt;/Size&gt;</span>
       <span class="nt">&lt;/Graphic&gt;</span>
    <span class="nt">&lt;/PointSymbolizer&gt;</span>
 <span class="nt">&lt;/Rule&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="datatypes">
<h3>DataTypes<a class="headerlink" href="#datatypes" title="Permalink to this headline">¶</a></h3>
<p>PostgreSQL defines two JSON datatypes:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">json</span></code> that stores an exact copy of the input text.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jsonb</span></code> which store the value in a decomposed binary format.</p></li>
</ul>
</div></blockquote>
<p>The jsonPointer function supports both, as well as the text format if it contains a valid json representation.
Anyways, the PostgreSQL documentation recommends usage of jsonb, as it is faster to process.</p>
<p>PostgreSQL supports also indexing on json types. And index on a specific json attribute can be created as follow:</p>
<p><code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">INDEX</span> <span class="pre">description_index</span> <span class="pre">ON</span> <span class="pre">table_name</span>
<span class="pre">((column_name</span> <span class="pre">-&gt;</span> <span class="pre">path</span> <span class="pre">-&gt;</span> <span class="pre">to</span> <span class="pre">-&gt;&gt;</span> <span class="pre">json_attribute</span> <span class="pre">))</span></code>.</p>
<p>Index can also be specified in partial way:</p>
<p><code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">INDEX</span> <span class="pre">description_index</span> <span class="pre">ON</span> <span class="pre">table_name</span>
<span class="pre">((column_name</span> <span class="pre">-&gt;</span> <span class="pre">path</span> <span class="pre">-&gt;</span> <span class="pre">to</span> <span class="pre">-&gt;&gt;</span> <span class="pre">json_attribute</span> <span class="pre">))</span>
<span class="pre">WHERE</span> <span class="pre">(column_name</span> <span class="pre">-&gt;</span> <span class="pre">path</span> <span class="pre">-&gt;</span> <span class="pre">to</span> <span class="pre">-&gt;&gt;</span> <span class="pre">json_attribute)</span> <span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code>.</p>
</div>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="index.html" title="previous chapter">Databases</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="h2.html" title="next chapter">H2</a></div>
      </div>
      </div><!-- /#content> -->
      <div id="content-right" class="content-border"></div>
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">PostGIS</a><ul>
<li><a class="reference internal" href="#adding-a-postgis-database">Adding a PostGIS database</a><ul>
<li><a class="reference internal" href="#using-default-connection">Using default connection</a></li>
<li><a class="reference internal" href="#using-jndi">Using JNDI</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-postgis-layers">Configuring PostGIS layers</a></li>
<li><a class="reference internal" href="#using-loose-bounding-box">Using loose bounding box</a></li>
<li><a class="reference internal" href="#publishing-a-postgis-view">Publishing a PostGIS view</a></li>
<li><a class="reference internal" href="#performance-considerations">Performance considerations</a><ul>
<li><a class="reference internal" href="#geos">GEOS</a></li>
<li><a class="reference internal" href="#spatial-indexing">Spatial indexing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-problems">Common problems</a><ul>
<li><a class="reference internal" href="#primary-keys">Primary keys</a></li>
<li><a class="reference internal" href="#multi-line">Multi-line</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jsonpointer-function-support">JsonPointer Function support</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#datatypes">DataTypes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="index.html" title="previous chapter">Databases</a></li>
            <li>Next: <a href="h2.html" title="next chapter">H2</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
                
        <li><a href="https://github.com/geoserver/geoserver/tree/master/doc/en/user/source/data/database/postgis.rst">Edit</a></li>
        </ul>
        </div>
  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div><!-- /#main -->
<div id="footer">
  <div class="wrap">
    &copy; Copyright 2021, Open Source Geospatial Foundation. License <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution</a>.
    Last updated on Jul 20, 2021.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>